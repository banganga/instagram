<style>
  .product-info__description {
    height: {{ section.settings.limit_description }};
  }
</style>

{%- assign current_variant = product.selected_or_first_available_variant -%}

<header class="page-header">
  {% if section.settings.breadcrumbs %}
    {% include 'breadcrumb' %}
  {% endif %}
</header>

<div class="product-template page-width--large" id="product_{{ product.id }}" data-section-id="product_{{ product.id }}" data-section-type="product-template">

  <div class="grid">
    <div class="grid__item one-whole large--two-thirds">

      {% if product.images.size > 1 %}
        <div class="product-images page-width grid grid--full" id="product_{{ product.id }}_images">
          <div class="product-images__thumbs grid__item one-fifth">
            <ul class="no-bullets js-product-thumbs">
              {% for image in product.images %}
                <li>
                  <div class="thumb-overlay">
                    <img src="{{ image.src | img_url: 'compact' }}" alt="{{ image.alt | escape }}" data-id="{{ image.id }}">
                  </div>
                </li>
              {% endfor %}
            </ul>
          </div>
          <div class="product-images__image grid__item four-fifths">
            <ul class="no-bullets js-product-image">
              {% for image in product.images %}
                <li>
                  <img src="{{ image.src | img_url: 'large' }}" alt="{{ image.alt | escape }}" data-original="{{ image.src | img_url: 'original' }}">
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% else %}
        <div class="product-images product-images--single grid grid--full" id="product_{{ product.id }}_images">
          <div class="product-images__image grid__item one-whole">
            {% assign featured_image = current_variant.featured_image | default: product.featured_image %}
            <img src="{{ featured_image | img_url: 'large' }}" alt="{{ featured_image.alt | escape }}" data-original="{{ featured_image | img_url: 'original' }}">
          </div>
        </div>
      {% endif %}

      {% if section.settings.use_tabs %}
        {% include 'product-tabs' %}
      {% else %}
        <div class="medium-down--hide product-description rte">
          {{ product.description }}
        </div>
      {% endif %}

    </div>
    {% comment %}
      ================= MOBILE VERSION =================
    {% endcomment %}
    <div class="grid__item one-whole large--hide">

      <div class="product-info page-width">
        <div class="product-price clearfix">
          {% include 'product-page-price' %}
        </div>
        <div class="product-info__title clearfix">
          {% include 'product-page-title' %}
          <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
        </div>
        {% if section.settings.description_location == 'top' %}
          {% include 'product-description' %}
        {% endif %}
      </div>

      <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
        <meta itemprop="priceCurrency" content="{{ shop.currency }}">
        <link itemprop="availability" href="http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}">

        <form action="/cart/add" method="post" enctype="multipart/form-data" class="product-form product-form-product_{{ product.id }}" data-section="product_{{ product.id }}">
          {% unless product.options.size == 1 and product.variants[0].title == 'Default Title' %}
            {%- assign options_count_mod = product.options.size | modulo: 2 -%}
            {% if options_count_mod == 0 %}
              {%- assign max_options = product.options.size -%}
            {% else %}
              {%- assign max_options = product.options.size | minus: 1 -%}
            {% endif %}
            {% comment %}
              Show maximum, but even amount of options
            {% endcomment %}
            <div class="product-options grid--full">
            {% for option in product.options_with_values limit: max_options %}
              {% capture current %}{% cycle 'first', 'last' %}{% endcapture %}
              <div class="grid__item one-half">
                {% include 'product-option' %}
              </div>
            {% endfor %}
            {% if product.options.size > max_options %}
              {% for option in product.options_with_values offset: max_options %}
                {%- assign current = 'first' -%}
                <div class="grid__item one-half">
                  {% include 'product-option' %}
                </div>
                <div class="grid__item one-half">
                  {% include 'product-quantity-selector' %}
                </div>
              {% endfor %}
            {% else %}
              <div class="grid__item one-quarter"></div>
              <div class="grid__item two-quarters text-center">
                {%- assign show_label = true -%}
                {% include 'product-quantity-selector' %}
              </div>
              <div class="grid__item one-quarter"></div>
            {% endif %}
            </div>
          {% endunless %}

          <select name="id" id="ProductSelect-product_{{ product.id }}" data-section="product_{{ product.id }}" class="product-form__variants no-js hide">
            {% for variant in product.variants %}
              {% if variant.available %}
                <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} value="{{ variant.id }}">
                  {{ variant.title }}
                </option>
              {% else %}
                <option disabled="disabled">{{ variant.title }} - {{ 'products.product.sold_out' | t }}</option>
              {% endif %}
            {% endfor %}
          </select>


          {% if section.settings.description_location == 'bottom' %}
            <div class="page-width">
              {% include 'product-description' %}
            </div>
          {% endif %}

          {% comment %}
            Cart button is hidden in mobile version and sticky version used
            see snippets/cart-sticky-button.liquid
          {% endcomment %}
          <div class="js-sticky-btn-start"></div>
        </form>
      </div>

    </div> <!-- end mobile -->

    {% comment %}
      ================= DESKTOP VERSION =================
    {% endcomment %}
    <div class="grid__item one-whole medium-down--hide large--one-third">
      <div class="product-info">
        {% include 'product-page-info' %}
        {% include 'product-meta' %}
      </div>
    </div> <!-- end desktop -->


    <div class="grid__item one-whole large--two-thirds">

      {% if section.settings.related_products %}
      <div class="related-products">
        {% include 'related-products' %}
      </div>
      {% endif %}

      {% if section.settings.display_icons %}
        {% include 'product-icons' %}
      {% endif %}

      <div class="{% if section.settings.use_tabs %}large--hide{% endif %}">
        <div id="shopify-product-reviews" class="js-delete--desktop" data-id="{{product.id}}">{{ product.metafields.spr.reviews }}</div>
      </div>
    </div>

  </div> <!-- end grid -->
</div>

{% unless product.empty? %}
  <script type="application/json" id="ProductJson-product_{{ product.id }}">
    {{ product | json }}
  </script>
{% endunless %}

{% schema %}
  {
    "name": "Product page",
    "settings": [
      {
        "type": "header",
        "content": "Layout"
      },
      {
        "type": "checkbox",
        "id": "breadcrumbs",
        "label": "Display breadcrumbs",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "display_icons",
        "label": "Display icons",
        "default": true
      },
      {
         "type": "select",
         "id": "description_location",
         "label": "Product description location",
         "options": [
            {"value": "top", "label": "Before options"},
            {"value": "bottom", "label": "After option"}
          ],
         "default": "top"
      },
      {
        "type": "header",
        "content": "Product properties"
      },
      {
        "type": "checkbox",
        "id": "display_quantity_selector",
        "label": "Display quantity selector",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "display_vendor",
        "label": "Display vendor",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "display_collections",
        "label": "Display collections",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "display_tags",
        "label": "Display tags",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "display_sku",
        "label": "Display SKU",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "display_product_type",
        "label": "Display product type",
        "default": false
      },
      {
        "type": "header",
        "content": "Related products"
      },
      {
        "type": "checkbox",
        "id": "related_products",
        "label": "Display related products",
        "default": true
      },
      {
        "type": "text",
        "id": "related_products_title",
        "label": "Widget title",
        "default": "Related products"
      },
      {
         "type": "select",
         "id": "related_products_count",
         "label": "Max number of products",
         "options": [
            {"value": "3", "label": "3"},
            {"value": "4", "label": "4"},
            {"value": "5", "label": "5"},
            {"value": "6", "label": "6"},
            {"value": "7", "label": "7"},
            {"value": "8", "label": "8"},
            {"value": "9", "label": "9"},
            {"value": "10", "label": "10"}
          ],
         "default": "4"
      },
      {
        "type": "header",
        "content": "Mobile version tweaks"
      },
      {
        "type": "checkbox",
        "id": "display_option_labels",
        "label": "Display labels for options",
        "default": false
      },
      {
         "type": "select",
         "id": "limit_description",
         "label": "Product description excerpt",
         "options": [
            {"value": "5rem", "label": "Show 3 lines"},
            {"value": "8rem", "label": "Show 5 lines"},
            {"value": "15rem", "label": "Show 10 lines"},
            {"value": "19rem", "label": "Show 12 lines"},
            {"value": "24rem", "label": "Show 15 lines"},
            {"value": "none", "label": "Show full text"}
          ],
         "default": "8rem",
         "info": "If the hidden part is less than 20% then full text will be shown"
      },
      {
        "type": "header",
        "content": "Tabs"
      },
      {
        "type": "checkbox",
        "id": "use_tabs",
        "label": "Use tabs",
        "default": true
      }
    ],
    "blocks": [
      {
        "type": "tab",
        "name": "tab",
        "settings": [
          {
            "type": "text",
            "id": "title",
            "label": "Tab title"
          },
          {
             "type": "page",
             "id": "page",
             "label": "Page"
          }
        ]
      }
    ]
  }
{% endschema %}
